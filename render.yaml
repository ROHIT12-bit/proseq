services:
  - type: web
    name: proseq
    env: python
    plan: free
    buildCommand: |
      echo "Step 0: Setup writable Rust environment"
      export CARGO_HOME=$HOME/.cargo
      export RUSTUP_HOME=$HOME/.rustup
      export PATH=$CARGO_HOME/bin:$PATH

      echo "Step 1: Upgrade pip"
      pip install --upgrade pip

      echo "Step 2: Install Rust build dependencies"
      pip install --upgrade wheel setuptools maturin

      echo "Step 3: Install Python requirements with verbose logging"
      pip install -r requirements.txt -v > /tmp/pip-install.log 2>&1 || \
      (echo "Pip install failed, see /tmp/pip-install.log"; cat /tmp/pip-install.log; exit 1)

      echo "Step 4: Done building"

    startCommand: |
      echo "Starting bot..."
      python RioShin.py

    # Cache Rust and pip directories to speed up next deploys
    cacheDirectories:
      - $HOME/.cargo
      - $HOME/.rustup
      - $HOME/.cache/pip
